{"ast":null,"code":"$(function () {\n  var war_el = $(\"#WarID\");\n  var WAR_ID = parseInt(war_el.attr(\"data-WarID\"));\n  window.App = {\n    Models: {},\n    Views: {},\n    Collections: {},\n    Router: {}\n  };\n  App.Models.WarMatch = Backbone.Model.extend({\n    urlRoot: \"/matches/war_matches/\",\n    initialize: function initialize() {\n      this.urlRoot += WAR_ID;\n    }\n  });\n  App.Collections.WarMatch = Backbone.Collection.extend({\n    model: App.Models.WarMatch,\n    url: \"/matches/war_matches/\",\n    initialize: function initialize() {\n      this.url += WAR_ID;\n      this.fetch();\n    }\n  });\n  /*\n  ** VIEW OF TABLE\n  */\n\n  App.Views.TableMatches = Backbone.View.extend({\n    template: _.template($(\"#MatchesTableTemplate\").html()),\n    initialize: function initialize() {\n      this.collection.on('sync', this.render, this);\n    },\n    render: function render() {\n      this.$el.html(this.template());\n      $(\"#WarMatches\").html(this.el);\n      matches = new App.Views.Matches({\n        collection: this.collection\n      });\n      matches.render();\n      return this;\n    }\n  });\n  /*\n  ** VIEW OF TABLE INNER (ALL ROWS)\n  */\n\n  App.Views.Matches = Backbone.View.extend({\n    tagName: 'tbody',\n    render: function render() {\n      this.collection.each(this.addOne, this);\n      $(\"#MatchesTable\").append(this.el);\n      return this;\n    },\n    addOne: function addOne(match) {\n      var row = new App.Views.Match({\n        model: match\n      });\n      this.$el.append(row.render().el);\n    }\n  });\n  /*\n  ** VIEW OF ONE MATCH (ONE ROW)\n  */\n\n  App.Views.Match = Backbone.View.extend({\n    template: _.template($(\"#MatchesRowTemplate\").html()),\n    tagName: 'tr',\n    events: {\n      'click #DeleteMatch': 'deleteMatch',\n      'click #JoinMatch': 'joinMatch'\n    },\n    render: function render() {\n      this.$el.html(this.template(this.model.attributes));\n\n      if (this.model.get(\"is_inprogress\") == false && this.model.get(\"is_end\") == false && current_user.guild_id == this.model.get(\"guild2\").id) {\n        this.$el[0].innerHTML = this.$el[0].innerHTML.replace('style=\"display: none\"', '');\n      }\n\n      return this;\n    },\n    deleteMatch: function deleteMatch() {\n      var _this = this;\n\n      if (confirm(\"Are you sure?\")) {\n        fetch('/matches/' + this.model.get('id'), {\n          method: 'DELETE'\n        }).then(function (res) {\n          return res.ok ? res : Promise.reject(res);\n        }).then(_.bind(function () {\n          alert('Success! Match was removed!');\n\n          _this.$el.remove();\n        }, this))[\"catch\"](function () {\n          alert('Error!');\n        });\n      }\n    },\n    joinMatch: function joinMatch(e) {\n      var _this2 = this;\n\n      e.preventDefault();\n      fetch(\"/wars/join_match\", {\n        method: \"POST\",\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          id: this.model.get('id')\n        })\n      }).then(function (res) {\n        return res.json();\n      }).then(function (res) {\n        if (res.error) alert(res.error);else Turbolinks.visit(\"/matches/\" + _this2.model.get('id'));\n      });\n    }\n  });\n  $('#WarMatchCreate').on(\"click\", function () {\n    fetch(\"/create_war_match\", {\n      method: \"POST\",\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        id: WAR_ID\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res) {\n      if (res.id) Turbolinks.visit(\"/matches/\" + res.id);else if (res.error) alert(res.error);else alert(\"Unknown error. Please, refresh your wars list\");\n    });\n  });\n  fetch(\"/profile/get_curr_user\").then(function (res) {\n    return res.ok ? res.json() : Promise.reject(res);\n  }).then(function (res) {\n    window.current_user = res;\n    col = new App.Collections.WarMatch();\n    new App.Views.TableMatches({\n      collection: col\n    });\n    $(\"#WarMatchRefresh\").on(\"click\", function () {\n      col.fetch();\n    });\n  });\n}());","map":{"version":3,"sources":["/pingpong/app/javascript/packs/war.js"],"names":["$","war_el","WAR_ID","parseInt","attr","window","App","Models","Views","Collections","Router","WarMatch","Backbone","Model","extend","urlRoot","initialize","Collection","model","url","fetch","TableMatches","View","template","_","html","collection","on","render","$el","el","matches","Matches","tagName","each","addOne","append","match","row","Match","events","attributes","get","current_user","guild_id","id","innerHTML","replace","deleteMatch","confirm","method","then","res","ok","Promise","reject","bind","alert","remove","joinMatch","e","preventDefault","headers","body","JSON","stringify","json","error","Turbolinks","visit","col"],"mappings":"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","sourcesContent":["$(function () {\n\n\tconst war_el = $(\"#WarID\");\n\tconst WAR_ID = parseInt(war_el.attr(\"data-WarID\"));\n\n\twindow.App = {\n\t\tModels: {},\n\t\tViews: {},\n\t\tCollections: {},\n\t\tRouter: {}\n\t};\n\n\tApp.Models.WarMatch = Backbone.Model.extend({\n\t\turlRoot: \"/matches/war_matches/\",\n\t\tinitialize: function () {\n\t\t\tthis.urlRoot += WAR_ID\n\t\t}\n\t});\n\n\tApp.Collections.WarMatch = Backbone.Collection.extend({\n\t\tmodel: App.Models.WarMatch,\n\t\turl: \"/matches/war_matches/\",\n\t\tinitialize: function () {\n\t\t\tthis.url += WAR_ID\n\t\t\tthis.fetch()\n\t\t}\n\t});\n\n/*\n** VIEW OF TABLE\n*/\n\tApp.Views.TableMatches = Backbone.View.extend({\n\t\ttemplate: _.template($(\"#MatchesTableTemplate\").html()),\n\t\tinitialize: function () {\n\t\t\tthis.collection.on('sync', this.render, this)\n\t\t},\n\t\trender: function () {\n\t\t\tthis.$el.html(this.template())\n\t\t\t$(\"#WarMatches\").html(this.el)\n\t\t\tmatches = new App.Views.Matches({ collection: this.collection })\n\t\t\tmatches.render()\n\t\t\treturn this\n\t\t},\n\t})\n\n\n/*\n** VIEW OF TABLE INNER (ALL ROWS)\n*/\n\tApp.Views.Matches = Backbone.View.extend({\n\t\ttagName: 'tbody',\n\t\trender: function () {\n\t\t\tthis.collection.each(this.addOne, this)\n\t\t\t$(\"#MatchesTable\").append(this.el)\n\t\t\treturn this\n\t\t},\n\t\taddOne: function (match) {\n\t\t\tvar row = new App.Views.Match({ model: match });\n\t\t\tthis.$el.append(row.render().el);\n\t\t}\n\t});\n\n/*\n** VIEW OF ONE MATCH (ONE ROW)\n*/\n\tApp.Views.Match = Backbone.View.extend({\n\t\ttemplate: _.template($(\"#MatchesRowTemplate\").html()),\n\t\ttagName: 'tr',\n\t\tevents: {\n\t\t\t'click #DeleteMatch': 'deleteMatch',\n\t\t\t'click #JoinMatch': 'joinMatch'\n\t\t},\n\t\trender: function () {\n\t\t\tthis.$el.html(this.template(this.model.attributes))\n\n\t\t\tif (this.model.get(\"is_inprogress\") == false && this.model.get(\"is_end\") == false && current_user.guild_id == this.model.get(\"guild2\").id) {\n\t\t\t\tthis.$el[0].innerHTML = this.$el[0].innerHTML.replace('style=\"display: none\"', '')\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\tdeleteMatch: function () {\n\t\t\tif (confirm(\"Are you sure?\")) {\n\t\t\t\tfetch('/matches/' + this.model.get('id'), {\n\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t})\n\t\t\t\t.then(res => res.ok ? res : Promise.reject(res))\n\t\t\t\t.then(_.bind(() => {\n\t\t\t\t\talert('Success! Match was removed!')\n\t\t\t\t\tthis.$el.remove();\n\t\t\t\t}, this))\n\t\t\t\t.catch(() => {\n\t\t\t\t\talert('Error!')\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tjoinMatch: function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tfetch(\"/wars/join_match\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({ id: this.model.get('id') })\n\t\t\t})\n\t\t\t.then(res => res.json())\n\t\t\t.then(res => {\n\t\t\t\tif (res.error)\n\t\t\t\t\talert(res.error)\n\t\t\t\telse\n\t\t\t\t\tTurbolinks.visit(\"/matches/\" + this.model.get('id')) \n\t\t\t})\n\t\t}\n\t});\n\n\t$('#WarMatchCreate').on(\"click\", function() {\n\t\tfetch(\"/create_war_match\", {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t'Accept': 'application/json',\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tbody: JSON.stringify({ id: WAR_ID })\n\t\t})\n\t\t.then(res => res.json())\n\t\t.then(res => {\n\t\t\tif (res.id)\n\t\t\t\tTurbolinks.visit(\"/matches/\" + res.id);\n\t\t\telse if (res.error)\n\t\t\t\talert(res.error)\n\t\t\telse\n\t\t\t\talert(\"Unknown error. Please, refresh your wars list\")\n\t\t})\n\t})\n\n\tfetch(\"/profile/get_curr_user\")\n\t.then(res => res.ok ? res.json() : Promise.reject(res))\n\t.then(function (res) { \n\t\twindow.current_user = res\n\t\n\t\tcol = new App.Collections.WarMatch()\n\t\tnew App.Views.TableMatches({ collection: col })\n\t\t$(\"#WarMatchRefresh\").on(\"click\", function() { col.fetch(); })\n\t})\n\n}());"]},"metadata":{},"sourceType":"module"}