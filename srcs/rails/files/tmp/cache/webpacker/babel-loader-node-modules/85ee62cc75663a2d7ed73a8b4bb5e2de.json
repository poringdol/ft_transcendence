{"ast":null,"code":"var _require = require(\"underscore\"),\n    result = _require.result;\n\n$(function () {\n  window.App = {\n    Models: {},\n    Views: {},\n    Collections: {}\n  };\n  /*\n  ** MODEL AND COLLECTION OF MATCHES\n  */\n\n  App.Models.Match = Backbone.Model.extend({\n    urlRoot: \"/matches.json\"\n  });\n  App.Collections.Match = Backbone.Collection.extend({\n    url: \"/matches.json\",\n    initialize: function initialize() {\n      this.fetch();\n    }\n  });\n  App.Views.RandomMatches = Backbone.View.extend({\n    el: $('#RandomMatchCreationForm'),\n    initialize: function initialize() {},\n    events: {\n      'click #RandomMatchCreationButton': 'create'\n    },\n    create: function create() {\n      fetch(\"/create_random_match.json\").then(function (res) {\n        return res.ok ? res.json() : Promise.reject(res);\n      }).then(_.bind(function (res) {\n        if (res.error) alert(res.error);else Turbolinks.visit(\"/matches/\" + res.id);\n      }, this));\n    }\n  });\n  App.Views.FormMatches = Backbone.View.extend({\n    el: $('#MatchCreationForm'),\n    initialize: function initialize() {},\n    events: {\n      'submit': 'submit'\n    },\n    submit: function submit(e) {\n      e.preventDefault();\n      var match = {\n        player2: $('#formPlayer2Nickname').val(),\n        color: $('input[name=\"radioColor\"]:checked').val(),\n        boost: $('#AddonBoost').is(':checked') ? $('#AddonBoost').val() : ''\n      };\n      fetch(\"/matches/new_match\", {\n        method: \"POST\",\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(match)\n      }).then(function (res) {\n        return res.json();\n      }).then(_.bind(function (res) {\n        if (res.error) alert(res.error);else Turbolinks.visit(\"/matches/\" + res.id);\n      }, this));\n    }\n  });\n  /*\n  ** VIEW OF TABLE INNER (ALL ROWS)\n  */\n\n  App.Views.Matches = Backbone.View.extend({\n    tagName: 'tbody',\n    initialize: function initialize(data) {\n      this.collection = data.collection;\n      this.type = data.type;\n    },\n    render: function render() {\n      this.collection.each(this.addOne, this);\n      $(\"#\" + this.type + \"MatchesTable\").append(this.el);\n      return this;\n    },\n    addOne: function addOne(match) {\n      if (this.type == 'History') {\n        if (match.get('is_end') == true) {\n          var row = new App.Views.Match({\n            model: match\n          });\n          this.$el.append(row.render().el);\n        }\n      } else if (this.type == 'Current') {\n        if (match.get('is_inprogress') == true && match.get('is_end') == false) {\n          var row = new App.Views.Match({\n            model: match\n          });\n          this.$el.append(row.render().el);\n        }\n      } else if (this.type == 'Planned') {\n        if (match.get('is_inprogress') == false && match.get('is_end') == false) {\n          var row = new App.Views.Match({\n            model: match\n          });\n          this.$el.append(row.render().el);\n        }\n      }\n    }\n  });\n  /*\n  ** VIEW OF TABLE\n  */\n\n  App.Views.TableMatches = Backbone.View.extend({\n    template: _.template($(\"#MatchesTableTemplate\").html()),\n    initialize: function initialize(data) {\n      this.collection = data.collection;\n      this.type = data.type;\n      this.collection.on('sync', this.render, this);\n    },\n    render: function render() {\n      this.$el.html(this.template({\n        type: this.type\n      }));\n      $(\"#\" + this.type + \"Matches\").html(this.el);\n      matches = new App.Views.Matches({\n        collection: this.collection,\n        type: this.type\n      });\n      matches.render();\n      return this;\n    }\n  });\n  /*\n  ** VIEW OF ONE MATCH (ONE ROW)\n  */\n\n  App.Views.Match = Backbone.View.extend({\n    template: _.template($(\"#MatchesRowTemplate\").html()),\n    tagName: 'tr',\n    events: {\n      'click #DeleteMatch': 'deleteMatch'\n    },\n    render: function render() {\n      this.model.attributes.addon_type = '';\n      if (this.model.attributes.addons.addon3 == true) this.model.attributes.addon_type = 'boost ';\n      if (this.model.attributes.addons.addon1 == true) this.model.attributes.addon_type += 'disco';else if (this.model.attributes.addons.addon2 == true) this.model.attributes.addon_type += 'epilepsy';\n      if (this.model.attributes.addon_type == '') this.model.attributes.addon_type = 'none';\n      this.$el.html(this.template(this.model.attributes));\n      return this;\n    },\n    deleteMatch: function deleteMatch() {\n      var _this = this;\n\n      if (confirm(\"Are you sure?\")) {\n        fetch('/matches/' + this.model.get('id'), {\n          method: 'DELETE'\n        }).then(function (res) {\n          return res.ok ? res : Promise.reject(res);\n        }).then(_.bind(function () {\n          alert('Success! Match was removed!');\n\n          _this.$el.remove();\n        }, this))[\"catch\"](function () {\n          alert('Error!');\n        });\n      }\n    }\n  });\n  /*\n  ** Выпадающий список со всеми пользователями для формы создания матча\n  */\n\n  App.Models.AllUsers = Backbone.Model.extend({\n    urlRoot: \"/users_list\"\n  });\n  App.Collections.AllUsers = Backbone.Collection.extend({\n    url: \"/users_list\",\n    model: App.Models.AllUsers,\n    initialize: function initialize() {\n      this.fetch();\n    }\n  });\n  App.Views.AllUsers = Backbone.View.extend({\n    initialize: function initialize() {\n      this.collection.on('sync', this.render, this);\n    },\n    render: function render() {\n      $('#formPlayer2Nickname').css('color', 'rgba(0, 0, 0, 0.55)');\n      $('#formPlayer2Nickname').append(\"<option value='' disabled selected>Select an opponent</option>\");\n      this.collection.each(function (it) {\n        var nickname = it.get(\"nickname\");\n        $('#formPlayer2Nickname').append(\"<option value='\".concat(nickname, \"'>\").concat(nickname, \"</option>\"));\n      });\n      return this;\n    }\n  });\n  /*\n  ** MAIN\n  */\n\n  var col = new App.Collections.Match();\n  new App.Views.FormMatches();\n  new App.Views.RandomMatches();\n  currentTable = new App.Views.TableMatches({\n    collection: col,\n    type: 'Current'\n  });\n  plannedTable = new App.Views.TableMatches({\n    collection: col,\n    type: 'Planned'\n  });\n  historyTable = new App.Views.TableMatches({\n    collection: col,\n    type: 'History'\n  });\n  var user_list = new App.Collections.AllUsers();\n  new App.Views.AllUsers({\n    collection: user_list\n  });\n  $(\"#MatchesTableRefresh\").on(\"click\", function () {\n    col.fetch();\n  });\n}());","map":{"version":3,"sources":["/pingpong/app/javascript/packs/matches.js"],"names":["require","result","$","window","App","Models","Views","Collections","Match","Backbone","Model","extend","urlRoot","Collection","url","initialize","fetch","RandomMatches","View","el","events","create","then","res","ok","json","Promise","reject","_","bind","error","alert","Turbolinks","visit","id","FormMatches","submit","e","preventDefault","match","player2","val","color","boost","is","method","headers","body","JSON","stringify","Matches","tagName","data","collection","type","render","each","addOne","append","get","row","model","$el","TableMatches","template","html","on","matches","attributes","addon_type","addons","addon3","addon1","addon2","deleteMatch","confirm","remove","AllUsers","css","it","nickname","col","currentTable","plannedTable","historyTable","user_list"],"mappings":"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","sourcesContent":["const { result } = require(\"underscore\");\n\n$(function () {\n\twindow.App = {\n\t\tModels: {},\n\t\tViews: {},\n\t\tCollections: {}\n\t};\n\n/*\n** MODEL AND COLLECTION OF MATCHES\n*/\n\tApp.Models.Match = Backbone.Model.extend({ urlRoot: \"/matches.json\" });\n\n\tApp.Collections.Match = Backbone.Collection.extend({\n\t\turl: \"/matches.json\",\n\t\tinitialize: function () {\n\t\t\tthis.fetch()\n\t\t}\n\t});\n\n\n\tApp.Views.RandomMatches = Backbone.View.extend({\n\t\tel: $('#RandomMatchCreationForm'),\n\t\tinitialize: function () {},\n\t\tevents: {\n\t\t\t'click #RandomMatchCreationButton': 'create'\n\t\t},\n\t\tcreate: function () {\n\t\t\tfetch(\"/create_random_match.json\")\n\t\t\t.then(res => res.ok ? res.json() : Promise.reject(res))\n\t\t\t.then(_.bind((res) => {\n\t\t\t\tif (res.error)\n\t\t\t\t\talert(res.error)\n\t\t\t\telse\n\t\t\t\t\tTurbolinks.visit(\"/matches/\" + res.id);\n\t\t\t}, this))\n\t\t},\n\t})\n\n\tApp.Views.FormMatches = Backbone.View.extend({\n\t\tel: $('#MatchCreationForm'),\n\t\tinitialize: function () {},\n\t\tevents: {\n\t\t\t'submit': 'submit'\n\t\t},\n\t\tsubmit: function (e) {\n\t\t\te.preventDefault();\n\t\t\tlet match = {\n\t\t\t\tplayer2: $('#formPlayer2Nickname').val(),\n\t\t\t\tcolor: $('input[name=\"radioColor\"]:checked').val(),\n\t\t\t\tboost: $('#AddonBoost').is(':checked') ? $('#AddonBoost').val() : '',\n\t\t\t}\n\t\t\tfetch(\"/matches/new_match\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(match)\n\t\t\t})\n\t\t\t.then(res => res.json())\n\t\t\t.then(_.bind((res) => {\n\t\t\t\tif (res.error)\n\t\t\t\t\talert(res.error)\n\t\t\t\telse\n\t\t\t\t\tTurbolinks.visit(\"/matches/\" + res.id);\n\t\t\t}, this))\n\t\t},\n\t})\n\n/*\n** VIEW OF TABLE INNER (ALL ROWS)\n*/\n\tApp.Views.Matches = Backbone.View.extend({\n\t\ttagName: 'tbody',\n\t\tinitialize: function (data) {\n\t\t\tthis.collection = data.collection\n\t\t\tthis.type = data.type\n\t\t},\n\t\trender: function () {\n\t\t\tthis.collection.each(this.addOne, this)\n\t\t\t$(\"#\" + this.type + \"MatchesTable\").append(this.el)\n\t\t\treturn this\n\t\t},\n\t\taddOne: function (match) {\n\t\t\tif (this.type == 'History') {\n\t\t\t\tif (match.get('is_end') == true) {\n\t\t\t\t\tvar row = new App.Views.Match({ model: match });\n\t\t\t\t\tthis.$el.append(row.render().el);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.type == 'Current') {\n\t\t\t\tif (match.get('is_inprogress') == true && match.get('is_end') == false) {\n\t\t\t\t\tvar row = new App.Views.Match({ model: match });\n\t\t\t\t\tthis.$el.append(row.render().el);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.type == 'Planned') {\n\t\t\t\tif (match.get('is_inprogress') == false && match.get('is_end') == false) {\n\t\t\t\t\tvar row = new App.Views.Match({ model: match });\n\t\t\t\t\tthis.$el.append(row.render().el);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\n\t\n/*\n** VIEW OF TABLE\n*/\n\tApp.Views.TableMatches = Backbone.View.extend({\n\t\ttemplate: _.template($(\"#MatchesTableTemplate\").html()),\n\t\tinitialize: function (data) {\n\t\t\tthis.collection = data.collection\n\t\t\tthis.type = data.type\n\n\t\t\tthis.collection.on('sync', this.render, this)\n\t\t},\n\t\trender: function () {\n\t\t\tthis.$el.html(this.template({ type: this.type }))\n\t\t\t$(\"#\" + this.type + \"Matches\").html(this.el)\n\t\t\tmatches = new App.Views.Matches({ collection: this.collection, type: this.type })\n\t\t\tmatches.render()\n\t\t\treturn this\n\t\t},\n\t})\n\n/*\n** VIEW OF ONE MATCH (ONE ROW)\n*/\n\tApp.Views.Match = Backbone.View.extend({\n\t\ttemplate: _.template($(\"#MatchesRowTemplate\").html()),\n\t\ttagName: 'tr',\n\t\tevents: {\n\t\t\t'click #DeleteMatch' : 'deleteMatch'\n\t\t},\n\t\trender: function () {\n\t\t\tthis.model.attributes.addon_type = ''\n\t\t\tif (this.model.attributes.addons.addon3 == true)\n\t\t\t\tthis.model.attributes.addon_type = 'boost '\n\t\t\tif (this.model.attributes.addons.addon1 == true)\n\t\t\t\tthis.model.attributes.addon_type += 'disco'\n\t\t\telse if (this.model.attributes.addons.addon2 == true)\n\t\t\t\tthis.model.attributes.addon_type += 'epilepsy'\n\t\t\tif (this.model.attributes.addon_type == '')\n\t\t\t\tthis.model.attributes.addon_type = 'none'\n\t\t\tthis.$el.html(this.template(this.model.attributes))\n\t\t\treturn this;\n\t\t},\n\t\tdeleteMatch: function () {\n\t\t\tif (confirm(\"Are you sure?\")) {\n\t\t\t\tfetch('/matches/' + this.model.get('id'), {\n\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t})\n\t\t\t\t.then(res => res.ok ? res : Promise.reject(res))\n\t\t\t\t.then(_.bind(() => {\n\t\t\t\t\talert('Success! Match was removed!')\n\t\t\t\t\tthis.$el.remove();\n\t\t\t\t}, this))\n\t\t\t\t.catch(() => {\n\t\t\t\t\talert('Error!')\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t});\n\n/*\n** Выпадающий список со всеми пользователями для формы создания матча\n*/\n\tApp.Models.AllUsers = Backbone.Model.extend({ urlRoot: \"/users_list\" })\n\tApp.Collections.AllUsers = Backbone.Collection.extend({\n\t\turl: \"/users_list\",\n\t\tmodel: App.Models.AllUsers,\n\t\tinitialize: function() { this.fetch(); },\n\t});\n\n\tApp.Views.AllUsers = Backbone.View.extend({\n\n\t\tinitialize: function() {\n\t\t\tthis.collection.on('sync', this.render, this)\n\t\t},\n        render: function () {\n\t\t\t$('#formPlayer2Nickname').css('color', 'rgba(0, 0, 0, 0.55)');\n\t\t\t$('#formPlayer2Nickname').append(`<option value='' disabled selected>Select an opponent</option>`);\n            this.collection.each((it) => {\n\t\t\t\tvar nickname = it.get(\"nickname\");\n\t\t\t\t$('#formPlayer2Nickname').append(`<option value='${nickname}'>${nickname}</option>`);\n\t\t\t});\n            return this;\n        }\n    });\n\n/*\n** MAIN\n*/\n\tvar col = new App.Collections.Match()\n\tnew App.Views.FormMatches\n\tnew App.Views.RandomMatches\n\tcurrentTable = new App.Views.TableMatches({ collection: col, type: 'Current' })\n\tplannedTable = new App.Views.TableMatches({ collection: col, type: 'Planned' })\n\thistoryTable = new App.Views.TableMatches({ collection: col, type: 'History' })\n\n\tvar user_list = new App.Collections.AllUsers()\n\tnew App.Views.AllUsers({ collection: user_list });\n\t$(\"#MatchesTableRefresh\").on(\"click\", function() { col.fetch(); })\n\n}());\n"]},"metadata":{},"sourceType":"module"}