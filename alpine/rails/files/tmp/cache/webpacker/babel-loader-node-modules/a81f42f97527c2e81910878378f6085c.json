{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n$(function () {\n  window.App = {\n    Models: {},\n    Views: {},\n    Collections: {},\n    Router: {}\n  };\n  App.Models.Guild = Backbone.Model.extend({\n    urlRoot: 'http://localhost:3000/guilds',\n    initialize: function initialize(curr_guild) {\n      this.id = curr_guild.id;\n      this.name = curr_guild.name;\n      this.anagram = curr_guild.anagram;\n      this.score = curr_guild.score;\n      this.owner_id = curr_guild.owner_id;\n      this.created_at = curr_guild.created_at;\n      this.updated_at = curr_guild.updated_at;\n    }\n  });\n  App.Collections.Guild = Backbone.Collection.extend({\n    model: App.Models.Guild,\n    url: 'http://localhost:3000/guilds',\n    initialize: function initialize() {\n      this.fetch();\n    }\n  });\n  App.Views.GuildList = Backbone.View.extend({\n    tagName: 'a',\n    className: 'list-group-item list-group-item-action',\n    templateList: _.template($(\"#GuildListTemplate\").html()),\n    initialize: function initialize(data) {\n      this.model = data.model;\n      this.user_id = data.user_id;\n      this.model.on('destroy', this.remove, this);\n    },\n    events: {\n      'click #GuildNameList': 'showCard'\n    },\n    render: function render() {\n      this.$el.attr({\n        'data-bs-toggle': \"list\"\n      });\n      var template = this.templateList(this.model);\n      this.$el.append(template);\n      return this;\n    },\n    remove: function remove() {\n      this.$el.remove();\n    },\n    showCard: function showCard() {\n      new App.Views.GuildCard({\n        model: this.model,\n        user_id: this.user_id\n      });\n      console.log(this.model.owner_nickname);\n    }\n  });\n  App.Views.GuildCard = Backbone.View.extend({\n    templateCard: _.template($(\"#GuildCardTemplate\").html()),\n    initialize: function initialize(data) {\n      this.model = data.model;\n      this.user_id = data.user_id;\n      this.model.on('destroy', this.remove, this);\n      this.showCard();\n    },\n    remove: function remove() {\n      this.$el.remove();\n    },\n    showCard: function () {\n      var _showCard = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var resp, owner, template;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return fetch(\"http://localhost:3000/get_owner_nickname\", {\n                  method: \"POST\",\n                  headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify(this.model)\n                });\n\n              case 2:\n                resp = _context.sent;\n                _context.next = 5;\n                return resp.json();\n\n              case 5:\n                owner = _context.sent;\n                this.model.owner_nickname = owner.nickname;\n                console.log(this.owner_nickname);\n                template = this.templateCard(this.model);\n                this.$el.html(template);\n                $('#GuildCard').html(this.el);\n\n                if (this.user_id == this.model.owner_id) {\n                  new App.Views.GuildDelBtn({\n                    model: this.model\n                  });\n                } else $('#GuildDeleteBtn').html(\"\"); // var promise = fetch(\"http://localhost:3000/get_owner_nickname\", {\n                // \tmethod: \"POST\",\n                // \theaders: {\n                // \t\t'Accept': 'application/json',\n                // \t\t'Content-Type': 'application/json'\n                // \t},\n                // \tbody: JSON.stringify(this.model)\n                // })\n                // .then(res => res.ok ? res.json() : Promise.reject(res))\n                // .then(_.bind(function (owner) {\n                // \tthis.model.owner_nickname = owner.nickname\n                // \tconsole.log(this.owner_nickname)\n                // \tvar template = this.templateCard(this.model);\n                // \tthis.$el.html(template);\n                // \t$('#GuildCard').html(this.el);\n                // \tif (this.user_id == this.model.owner_id) {\n                // \t\tnew App.Views.GuildDelBtn({\n                // \t\t\tmodel: this.model\n                // \t\t})\n                // \t}\n                // \telse\n                // \t\t$('#GuildDeleteBtn').html(\"\");\n                // }, this))\n\n\n                return _context.abrupt(\"return\", this);\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function showCard() {\n        return _showCard.apply(this, arguments);\n      }\n\n      return showCard;\n    }()\n  });\n  App.Views.GuildDelBtn = Backbone.View.extend({\n    templateDeleteBtn: _.template($(\"#GuildDelBtnTemplate\").html()),\n    events: {\n      'click #delete_guild': 'delete_guild'\n    },\n    initialize: function initialize() {\n      this.$el.html(this.templateDeleteBtn);\n      $('#GuildDeleteBtn').html(this.el);\n    },\n    delete_guild: function delete_guild() {\n      alert(\"DELETE\");\n      var promise = this.model.destroy([], {\n        dataType: \"text\"\n      });\n      $.when(promise).done(_.bind(function (data) {\n        $('#GuildForm').css({\n          \"display\": \"block\"\n        });\n      }, this));\n    }\n  });\n  App.Views.Guilds = Backbone.View.extend({\n    className: 'list-group',\n    initialize: function initialize(data) {\n      this.collection = data.collection;\n      this.user_id = data.user_id;\n      this.collection.on('add', this.addOne, this);\n      this.collection.on('change', this.addOne, this);\n      this.render();\n    },\n    render: function render() {\n      this.collection.each(this.addOne, this);\n      $('#GuildList').append(this.el);\n      return this;\n    },\n    addOne: function addOne(guild) {\n      var guildView = new App.Views.GuildList({\n        model: guild,\n        user_id: this.user_id\n      });\n      this.$el.append(guildView.render().el);\n    }\n  });\n  App.Views.NewGuild = Backbone.View.extend({\n    template: _.template($(\"#GuildFormTemplate\").html()),\n    // initialize: function () {\n    // \tthis.$el.html(this.template)\n    // },\n    events: {\n      'submit': 'submit'\n    },\n    render: function render() {\n      this.$el.html(this.template);\n      $('#GuildForm').html(this.el);\n    },\n    submit: function submit(e) {\n      e.preventDefault();\n      var guild = {\n        name: $(e.currentTarget).find('input[id=guildFormName]').val(),\n        anagram: $(e.currentTarget).find('input[id=guildFormAnagram]').val()\n      };\n      new_guild = new App.Models.Guild(guild);\n      var promise = new_guild.save([], {\n        dataType: \"text\"\n      });\n      $.when(promise).done(_.bind(function (data) {\n        alert('success');\n        this.collection.fetch();\n        $('#GuildForm').css({\n          \"display\": \"none\"\n        });\n      }, this));\n      $.when(promise).fail(function (resp) {\n        alert(resp.responseText);\n      });\n    }\n  });\n  fetch(\"http://localhost:3000/get_curr_user\").then(function (res) {\n    return res.ok ? res.json() : Promise.reject(res);\n  }).then(function (curr_user_id) {\n    col = new App.Collections.Guild();\n    form = new App.Views.NewGuild({\n      collection: col\n    });\n    form.render();\n    guilds_view = new App.Views.Guilds({\n      collection: col,\n      user_id: curr_user_id\n    });\n  });\n}());","map":{"version":3,"sources":["/pingpong/app/javascript/packs/index.js"],"names":["$","window","App","Models","Views","Collections","Router","Guild","Backbone","Model","extend","urlRoot","initialize","curr_guild","id","name","anagram","score","owner_id","created_at","updated_at","Collection","model","url","fetch","GuildList","View","tagName","className","templateList","_","template","html","data","user_id","on","remove","events","render","$el","attr","append","showCard","GuildCard","console","log","owner_nickname","templateCard","method","headers","body","JSON","stringify","resp","json","owner","nickname","el","GuildDelBtn","templateDeleteBtn","delete_guild","alert","promise","destroy","dataType","when","done","bind","css","Guilds","collection","addOne","each","guild","guildView","NewGuild","submit","e","preventDefault","currentTarget","find","val","new_guild","save","fail","responseText","then","res","ok","Promise","reject","curr_user_id","col","form","guilds_view"],"mappings":"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","sourcesContent":["$(function () {\n\twindow.App = {\n\t\tModels: {},\n\t\tViews: {},\n\t\tCollections: {},\n\t\tRouter: {}\n\t};\n\n\tApp.Models.Guild = Backbone.Model.extend({\n\t\turlRoot: 'http://localhost:3000/guilds',\n\t\tinitialize: function (curr_guild) {\n\t\t\tthis.id = curr_guild.id;\n\t\t\tthis.name = curr_guild.name;\n\t\t\tthis.anagram = curr_guild.anagram;\n\t\t\tthis.score = curr_guild.score;\n\t\t\tthis.owner_id = curr_guild.owner_id;\n\t\t\tthis.created_at = curr_guild.created_at;\n\t\t\tthis.updated_at = curr_guild.updated_at;\n\t\t}\n\t\t\n\t});\n\n\tApp.Collections.Guild = Backbone.Collection.extend({\n\t\tmodel: App.Models.Guild,\n\t\turl: 'http://localhost:3000/guilds',\n\t\tinitialize: function () {\n\t\t\tthis.fetch();\n\t\t}\n\t});\n\t\n\tApp.Views.GuildList = Backbone.View.extend({\n\t\ttagName: 'a',\n\t\tclassName: 'list-group-item list-group-item-action',\n\n\t\ttemplateList: _.template($(\"#GuildListTemplate\").html()),\n\n\t\tinitialize: function (data) {\n\t\t\tthis.model = data.model;\n\t\t\tthis.user_id = data.user_id;\n\n\t\t\tthis.model.on('destroy', this.remove, this);\n\t\t},\n\t\tevents: {\n\t\t\t'click #GuildNameList' : 'showCard'\n\t\t},\n\t\trender: function () {\n\t\t\tthis.$el.attr({'data-bs-toggle': \"list\"});\n\t\t\tvar template = this.templateList(this.model);\n\t\t\tthis.$el.append(template);\n\t\t\treturn this;\n\t\t},\n\t\tremove: function () {\n\t\t\tthis.$el.remove();\n\t\t},\n\t\tshowCard: function () {\n\t\t\tnew App.Views.GuildCard({\n\t\t\t\tmodel: this.model,\n\t\t\t\tuser_id: this.user_id\n\t\t\t})\n\t\t\tconsole.log(this.model.owner_nickname)\n\t\t}\n\t})\n\n\tApp.Views.GuildCard = Backbone.View.extend({\n\t\t\n\t\ttemplateCard: _.template($(\"#GuildCardTemplate\").html()),\n\t\t\n\t\tinitialize: function (data) {\n\t\t\tthis.model = data.model;\n\t\t\tthis.user_id = data.user_id;\n\t\t\tthis.model.on('destroy', this.remove, this);\n\t\t\tthis.showCard();\n\t\t},\n\t\tremove: function () {\n\t\t\tthis.$el.remove();\n\t\t},\n\t\tshowCard: async function () {\n\t\t\tlet resp = await fetch(\"http://localhost:3000/get_owner_nickname\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(this.model)\n\t\t\t})\n\t\t\tlet owner = await resp.json()\n\t\t\tthis.model.owner_nickname = owner.nickname\n\t\t\t\tconsole.log(this.owner_nickname)\n\t\t\t\tvar template = this.templateCard(this.model);\n\t\t\t\tthis.$el.html(template);\n\t\t\t\t$('#GuildCard').html(this.el);\n\t\t\t\tif (this.user_id == this.model.owner_id) {\n\t\t\t\t\tnew App.Views.GuildDelBtn({\n\t\t\t\t\t\tmodel: this.model\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\t$('#GuildDeleteBtn').html(\"\");\n\t\t\t// var promise = fetch(\"http://localhost:3000/get_owner_nickname\", {\n\t\t\t// \tmethod: \"POST\",\n\t\t\t// \theaders: {\n\t\t\t// \t\t'Accept': 'application/json',\n\t\t\t// \t\t'Content-Type': 'application/json'\n\t\t\t// \t},\n\t\t\t// \tbody: JSON.stringify(this.model)\n\t\t\t// })\n\t\t\t// .then(res => res.ok ? res.json() : Promise.reject(res))\n\t\t\t// .then(_.bind(function (owner) {\n\t\t\t// \tthis.model.owner_nickname = owner.nickname\n\t\t\t// \tconsole.log(this.owner_nickname)\n\t\t\t// \tvar template = this.templateCard(this.model);\n\t\t\t// \tthis.$el.html(template);\n\t\t\t// \t$('#GuildCard').html(this.el);\n\t\t\t// \tif (this.user_id == this.model.owner_id) {\n\t\t\t// \t\tnew App.Views.GuildDelBtn({\n\t\t\t// \t\t\tmodel: this.model\n\t\t\t// \t\t})\n\t\t\t// \t}\n\t\t\t// \telse\n\t\t\t// \t\t$('#GuildDeleteBtn').html(\"\");\n\t\t\t// }, this))\n\t\t\treturn this;\n\t\t}\n\t})\n\n\tApp.Views.GuildDelBtn = Backbone.View.extend({\n\n\t\ttemplateDeleteBtn: _.template($(\"#GuildDelBtnTemplate\").html()),\n\n\t\tevents: {\n\t\t\t'click #delete_guild': 'delete_guild',\n\t\t},\n\n\t\tinitialize: function () {\n\t\t\tthis.$el.html(this.templateDeleteBtn);\n\t\t\t$('#GuildDeleteBtn').html(this.el);\n\t\t},\n\n\t\tdelete_guild: function () {\n\t\t\talert(\"DELETE\");\n\t\t\tvar promise = this.model.destroy([], {\n\t\t\t\tdataType: \"text\"\n\t\t\t})\n\t\t\t\n\t\t\t$.when(promise).done(\n\t\t\t\t_.bind(function (data) {\n\t\t\t\t\t$('#GuildForm').css({ \"display\": \"block\" });\n\t\t\t\t}, this)\n\t\t\t);\n\t\t},\n\t})\n\n\tApp.Views.Guilds = Backbone.View.extend({\n\t\tclassName: 'list-group',\n\t\tinitialize: function (data) {\n\t\t\tthis.collection = data.collection;\n\t\t\tthis.user_id = data.user_id;\n\n\t\t\tthis.collection.on('add', this.addOne, this);\n\t\t\tthis.collection.on('change', this.addOne, this);\n\t\t\tthis.render();\n\t\t},\n\t\trender: function () {\n\t\t\tthis.collection.each(this.addOne, this);\n\t\t\t$('#GuildList').append(this.el);\n\t\t\treturn this;\n\t\t},\n\t\taddOne: function (guild) {\n\t\t\tvar guildView = new App.Views.GuildList({ model: guild, user_id: this.user_id });\n\t\t\tthis.$el.append(guildView.render().el);\n\t\t}\n\t});\n\n\tApp.Views.NewGuild = Backbone.View.extend({\n\t\ttemplate: _.template($(\"#GuildFormTemplate\").html()),\n\t\t// initialize: function () {\n\t\t// \tthis.$el.html(this.template)\n\t\t// },\n\t\tevents: {\n\t\t\t'submit': 'submit'\n\t\t},\n\t\trender: function () {\n\t\t\tthis.$el.html(this.template) \n\t\t\t$('#GuildForm').html(this.el);\n\t\t},\n\t\tsubmit: function (e) {\n\t\t\te.preventDefault();\n\t\t\tlet guild = {\n\t\t\t\tname: $(e.currentTarget).find('input[id=guildFormName]').val(),\n\t\t\t\tanagram: $(e.currentTarget).find('input[id=guildFormAnagram]').val()\n\t\t\t}\n\t\t\tnew_guild = new App.Models.Guild(guild);\n\n\t\t\tvar promise = new_guild.save([], {\n\t\t\t\tdataType: \"text\"\n\t\t\t})\n\n\t\t\t$.when(promise).done(\n\t\t\t\t_.bind(function (data) {\n    \t\t\t\talert('success');\n\t\t\t\t\tthis.collection.fetch()\n\t\t\t\t\t$('#GuildForm').css({ \"display\": \"none\" });\n\t\t\t\t}, this)\n\t\t\t);\n\n\t\t\t$.when(promise).fail(function (resp) {\n\t\t\t\talert(resp.responseText);\n\t\t\t});\n\t\t},\n\n\t})\n\tfetch(\"http://localhost:3000/get_curr_user\")\n\t.then(res => res.ok ? res.json() : Promise.reject(res))\n\t.then(function(curr_user_id) {\n\t\tcol = new App.Collections.Guild();\n\t\tform = new App.Views.NewGuild({ collection: col });\n\t\tform.render();\n\t\tguilds_view = new App.Views.Guilds( {collection: col, user_id: curr_user_id} );\n\t})\t\n}());"]},"metadata":{},"sourceType":"module"}